import { Component, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';

@Component({
  selector: 'app-light-intensity',
  imports: [],
  template: `
    <div class="flex flex-col gap-1 p-2 items-center">
      <svg 
        class="w-32 h-32 transition-all duration-500 ease-in-out"
        viewBox="0 0 836.000000 980.000000"
        [style.fill]="lampColor"
        [style.filter]="'brightness('+lampBrigthness+')'"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g 
          transform="translate(0.000000,980.000000) scale(0.100000,-0.100000)"
          [style.fill]="lampColor"
          [style.filter]="'brightness('+lampBrigthness+')'"
          fill="black"
          stroke="none"
        >
          <path d="M4115 9786 c-49 -22 -96 -79 -106 -128 -11 -57 -11 -750 0 -808 11 -54 68 -112 130 -131 86 -26 190 39 210 132 13 59 14 742 2 807 -20 103 -143 169 -236 128z"/>
          <path d="M1270 8598 c-56 -29 -80 -73 -80 -149 0 -45 6 -64 31 -105 40 -62 487 -508 554 -553 44 -29 56 -32 103 -28 90 7 165 86 166 176 1 37 -6 56 -33 96 -48 70 -495 516 -555 554 -62 39 -121 41 -186 9z"/>
          <path d="M6904 8589 c-58 -37 -516 -494 -559 -558 -73 -109 3 -258 137 -268 47 -4 59 -1 103 28 67 45 514 491 554 553 25 41 31 60 31 105 0 76 -24 120 -80 149 -65 32 -124 30 -186 -9z"/>
          <path d="M3860 8334 c-14 -3 -90 -18 -170 -34 -529 -105 -943 -312 -1335 -666 -501 -453 -829 -1098 -875 -1724 -13 -175 -13 -465 1 -610 31 -343 188 -779 402 -1116 231 -365 502 -632 898 -887 l129 -82 0 -416 c0 -230 4 -439 10 -468 7 -38 21 -66 51 -102 l42 -49 1166 0 1166 0 43 50 c34 40 45 61 52 107 6 32 10 243 11 468 l0 410 147 95 c207 134 347 245 498 395 147 146 217 231 326 390 217 319 373 703 443 1090 22 121 31 525 16 713 -37 466 -220 941 -515 1336 -362 486 -848 828 -1418 1000 -151 46 -283 72 -433 86 -128 12 -613 22 -655 14z m680 -379 c381 -65 799 -242 1053 -444 111 -90 333 -306 425 -416 260 -310 447 -760 502 -1210 15 -117 14 -394 0 -515 -53 -439 -233 -869 -508 -1215 -73 -92 -248 -271 -343 -350 -97 -81 -268 -197 -388 -260 -51 -28 -112 -66 -134 -86 -39 -34 -41 -39 -48 -110 -4 -41 -8 -239 -8 -441 l-1 -368 -910 0 -910 0 -1 368 c0 202 -4 400 -8 441 -7 71 -9 76 -48 110 -22 20 -82 59 -134 86 -204 110 -370 236 -559 425 -264 264 -448 556 -564 897 -96 284 -130 509 -123 823 7 313 52 538 163 820 146 366 400 701 745 979 317 256 754 431 1204 481 122 13 484 5 595 -15z"/>
          <path d="M4122 7606 c-45 -16 -98 -70 -113 -113 -15 -45 -7 -103 20 -147 34 -55 89 -75 253 -92 257 -27 421 -70 598 -158 176 -87 321 -197 476 -359 125 -131 219 -262 289 -402 94 -189 134 -337 161 -589 17 -163 21 -181 45 -221 39 -65 150 -96 218 -61 44 23 89 81 96 123 3 21 8 46 10 56 12 62 -35 379 -82 541 -187 653 -741 1195 -1398 1367 -224 58 -493 84 -573 55z"/>
          <path d="M176 5799 c-59 -6 -74 -12 -103 -41 -47 -45 -63 -79 -63 -133 0 -85 62 -158 147 -171 62 -10 724 -10 786 0 85 13 147 86 147 171 0 54 -16 88 -62 133 -31 29 -44 34 -119 42 -99 12 -633 11 -733 -1z"/>
          <path d="M7436 5799 c-59 -6 -74 -12 -103 -41 -19 -18 -41 -45 -49 -60 -17 -32 -18 -111 -3 -141 22 -42 74 -88 114 -99 27 -7 165 -11 415 -11 250 0 388 4 415 11 45 13 98 62 114 105 15 40 14 103 -3 135 -8 15 -30 42 -48 60 -31 29 -44 34 -119 42 -99 12 -633 11 -733 -1z"/>
          <path d="M1774 3459 c-64 -41 -513 -490 -553 -553 -25 -40 -31 -61 -31 -104 0 -109 57 -167 165 -167 52 0 67 5 110 34 63 44 500 480 543 543 40 58 48 95 32 143 -14 44 -62 100 -101 121 -48 24 -109 18 -165 -17z"/>
          <path d="M6415 3471 c-67 -40 -113 -124 -101 -182 3 -17 20 -51 38 -77 43 -63 480 -499 543 -543 43 -29 58 -34 110 -34 108 0 165 58 165 167 0 43 -6 64 -31 104 -40 63 -489 512 -553 553 -59 37 -123 42 -171 12z"/>
          <path d="M2975 1769 c-89 -99 -86 -178 8 -276 l41 -43 1156 0 1156 0 41 43 c94 98 97 177 8 276 l-37 41 -1168 0 -1168 0 -37 -41z"/>
          <path d="M2983 1048 c-94 -99 -97 -178 -8 -277 l37 -41 1168 0 1168 0 37 41 c89 99 86 178 -8 277 l-41 42 -1156 0 -1156 0 -41 -42z"/>
          <path d="M3337 311 c-85 -90 -85 -172 0 -262 l46 -49 797 0 798 0 46 51 c83 93 83 170 -1 260 l-46 49 -797 0 -797 0 -46 -49z"/>
        </g>
      </svg>
      <p class="text-xl font-bold text-gray-800 mt-2">{{luxValue}} Lux</p>
    </div>
  `,
  styles: ``
})
export class LightIntensity implements OnInit, OnChanges {
  @Input() luxValue!: number;
  @Input() minLux: number = 100;
  @Input() maxLux: number = 1000;

  lampColor: string = '#FFD700';
  lampBrigthness: number = 1;

  ngOnInit(): void {
    this.updateLampAppearence();
  }

  ngOnChanges(changes: SimpleChanges): void {
    if(changes['luxValue'] || changes['minLux'] || changes['maxLux']) {
      this.updateLampAppearence();
    }
  }

  private updateLampAppearence(): void {
    const clampedLux = Math.max(this.minLux, Math.min(this.maxLux, this.luxValue));

    const normalizedLux = (clampedLux - this.minLux) / (this.maxLux - this.minLux);

    this.lampBrigthness = 0.5 + (normalizedLux * 1.5);
  }
}
